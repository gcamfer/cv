<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ cv.personal.name }} - CV</title>
    <style>
        @page {
            size: A4;
            margin: 0.8cm 0.7cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: 9pt;
            line-height: 1.35;
            color: #2c3e50;
            background: #fff;
        }
        
        /* Header with color */
        .header {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            padding: 0.5cm 0.4cm;
            margin: -0.8cm -0.7cm 0.3cm -0.7cm;
            margin-bottom: 0.4cm;
        }
        
        .header h1 {
            font-size: 20pt;
            font-weight: bold;
            margin-bottom: 0.15cm;
            letter-spacing: 0.5pt;
            color: white;
        }
        
        .header .title {
            font-size: 11pt;
            color: #e0e7ff;
            margin-bottom: 0.25cm;
            font-weight: 500;
        }
        
        .header .contact {
            font-size: 8.5pt;
            color: #c7d2fe;
            line-height: 1.6;
        }
        
        .header .contact span {
            margin-right: 0.5cm;
            display: inline-block;
        }
        
        /* Two-column layout using table */
        .main-container {
            display: table;
            width: 100%;
            table-layout: fixed;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .sidebar-column {
            display: table-cell;
            width: 3.8cm;
            vertical-align: top;
            padding-right: 0.6cm;
            border-right: 2px solid #e5e7eb;
        }
        
        .content-column {
            display: table-cell;
            vertical-align: top;
            padding-left: 0.6cm;
        }
        
        /* Sidebar styling */
        .sidebar-section {
            margin-bottom: 0.4cm;
            page-break-inside: avoid;
        }
        
        .sidebar-section h2 {
            font-size: 10pt;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.8pt;
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 0.1cm;
            margin-bottom: 0.25cm;
        }
        
        .sidebar-section p, .sidebar-section li {
            font-size: 8.5pt;
            line-height: 1.5;
            margin-bottom: 0.12cm;
            color: #374151;
        }
        
        .sidebar-section ul {
            list-style: none;
            padding-left: 0;
        }
        
        .sidebar-section li {
            margin-bottom: 0.1cm;
            padding-left: 0.25cm;
            position: relative;
        }
        
        .sidebar-section li:before {
            content: "▸";
            color: #2563eb;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .language-item {
            margin-bottom: 0.15cm;
            padding-left: 0.25cm;
        }
        
        .language-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .language-proficiency {
            color: #6b7280;
            font-size: 8pt;
        }
        
        .cert-item {
            margin-bottom: 0.25cm;
            page-break-inside: avoid;
            padding: 0.2cm;
            background: #f9fafb;
            border-left: 3px solid #2563eb;
            padding-left: 0.3cm;
        }
        
        .cert-name {
            font-weight: 600;
            font-size: 8.5pt;
            color: #1f2937;
            margin-bottom: 0.05cm;
        }
        
        .cert-issuer {
            font-size: 8pt;
            color: #4b5563;
            margin-bottom: 0.05cm;
        }
        
        .cert-date {
            font-size: 7.5pt;
            color: #6b7280;
        }
        
        /* Main content sections */
        .section {
            margin-bottom: 0.25cm;
        }
        
        /* Keep sections together except Professional Experience */
        .section:not(#experience-section) {
            page-break-inside: avoid;
        }
        
        /* Professional Experience - allow breaks between jobs */
        #experience-section {
            page-break-inside: auto;
        }
        
        .section h2 {
            font-size: 11.5pt;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.8pt;
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 0.1cm;
            margin-bottom: 0.2cm;
            margin-top: 0.15cm;
        }
        
        .about-text {
            font-size: 8.5pt;
            line-height: 1.4;
            text-align: justify;
            margin-bottom: 0.15cm;
            color: #374151;
        }
        
        .experience-item, .education-item {
            margin-bottom: 0.25cm;
            padding: 0.2cm;
            background: #f9fafb;
            border-left: 3px solid #3b82f6;
            padding-left: 0.3cm;
        }
        
        /* Keep each job together, but allow breaks between jobs */
        .experience-item {
            page-break-inside: avoid; /* Keep individual job intact */
            page-break-after: auto; /* Allow break after each job */
            break-inside: avoid; /* CSS3 property for better support */
        }
        
        /* Keep education items together */
        .education-item {
            page-break-inside: avoid;
        }
        
        .job-header, .edu-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.15cm;
        }
        
        .job-title, .edu-degree {
            font-weight: bold;
            font-size: 10pt;
            color: #1f2937;
        }
        
        .job-company, .edu-institution {
            font-size: 9pt;
            color: #2563eb;
            font-weight: 500;
            margin-top: 0.05cm;
        }
        
        .job-dates, .edu-dates {
            font-size: 8.5pt;
            color: #6b7280;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .job-description, .edu-highlights {
            font-size: 8.5pt;
            line-height: 1.4;
            margin-top: 0.15cm;
            margin-bottom: 0.15cm;
            color: #374151;
        }
        
        .job-description ul, .edu-highlights ul {
            list-style: none;
            padding-left: 0;
        }
        
        .job-description li, .edu-highlights li {
            margin-bottom: 0.12cm;
            padding-left: 0.4cm;
            position: relative;
        }
        
        .job-description li:before, .edu-highlights li:before {
            content: "•";
            color: #3b82f6;
            font-weight: bold;
            position: absolute;
            left: 0.15cm;
        }
        
        .tech-tags {
            font-size: 7.5pt;
            color: #4b5563;
            font-style: italic;
            margin-top: 0.15cm;
            padding-top: 0.15cm;
            border-top: 1px solid #e5e7eb;
        }
        
        .tech-tags span {
            margin-right: 0.25cm;
        }
        
        .tech-tags span:after {
            content: ",";
        }
        
        .tech-tags span:last-child:after {
            content: "";
        }
        
        .skills-grid {
            display: block;
            font-size: 8.5pt;
        }
        
        .skill-category {
            margin-bottom: 0.25cm;
        }
        
        .skill-category h3 {
            font-size: 9pt;
            font-weight: 600;
            margin-bottom: 0.12cm;
            color: #1f2937;
        }
        
        .skill-category ul {
            list-style: none;
            padding-left: 0;
        }
        
        .skill-category li {
            margin-bottom: 0.08cm;
            padding-left: 0.3cm;
            position: relative;
        }
        
        .skill-category li:before {
            content: "▸";
            color: #2563eb;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        /* Publications */
        .publication-item {
            margin-bottom: 0.2cm;
            font-size: 8.5pt;
            color: #374151;
        }
        
        .publication-title {
            font-weight: 600;
            color: #1f2937;
        }
        
        .publication-journal {
            font-style: italic;
            color: #6b7280;
        }
        
        /* Utilities */
        .text-small {
            font-size: 8pt;
        }
        
        .text-tiny {
            font-size: 7.5pt;
        }
        
        .mt-small {
            margin-top: 0.2cm;
        }
        
        .mb-small {
            margin-bottom: 0.2cm;
        }
        
        /* Experience total */
        .experience-total {
            font-size: 8.5pt;
            color: #2563eb;
            font-weight: 600;
            margin-top: 0.1cm;
            margin-bottom: 0.1cm;
        }
        
        /* First section should have less top margin */
        .content-column > .section:first-child {
            margin-top: 0;
        }
        
        .content-column > .section:first-child h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <!-- Header with gradient background -->
    <div class="header">
        <h1>{{ cv.personal.name }}</h1>
        <div class="title">{{ cv.personal.title }}</div>
        <div class="contact">
            <span>{{ cv.personal.location }}</span>
            <span>{{ cv.personal.email }}</span>
            <span>{{ cv.personal.phone }}</span>
            {% if cv.personal.github %}
            <span>GitHub: {{ cv.personal.github }}</span>
            {% endif %}
        </div>
    </div>
    
    <!-- Two-column layout -->
    <div class="main-container">
        <!-- Sidebar Column -->
        <div class="sidebar-column">
            <!-- Languages -->
            {% if cv.languages %}
            <div class="sidebar-section">
                <h2>Languages</h2>
                {% for language in cv.languages %}
                <div class="language-item">
                    <span class="language-name">{{ language.name }}</span>
                    {% if language.proficiency %}
                    <span class="language-proficiency">({{ language.proficiency }})</span>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Key Skills -->
            {% if cv.skills %}
            <div class="sidebar-section">
                <h2>Key Skills</h2>
                {% if cv.skills.computer_vision %}
                <div class="skill-category">
                    <h3>Computer Vision</h3>
                    <ul>
                        {% for skill in cv.skills.computer_vision[:3] %}
                        <li>{{ skill }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                {% if cv.skills.ml_general %}
                <div class="skill-category">
                    <h3>ML & MLOps</h3>
                    <ul>
                        {% for skill in cv.skills.ml_general[:4] %}
                        <li>{{ skill }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                {% if cv.skills.data_engineering %}
                <div class="skill-category">
                    <h3>Data Engineering</h3>
                    <ul>
                        {% for skill in cv.skills.data_engineering[:3] %}
                        <li>{{ skill }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                {% if cv.skills.geospatial %}
                <div class="skill-category">
                    <h3>Geospatial</h3>
                    <ul>
                        {% for skill in cv.skills.geospatial[:2] %}
                        <li>{{ skill }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Programming Languages -->
            {% if cv.programming_languages %}
            <div class="sidebar-section">
                <h2>Programming</h2>
                <ul>
                    {% for lang in cv.programming_languages %}
                    <li>
                        {{ lang.name }}
                        {% if lang.start_date %}
                        ({{ lang.start_date | calculate_years }}+ yrs)
                        {% elif lang.years_experience %}
                        ({{ lang.years_experience }} yrs)
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Certifications (Active Only) -->
            {% if cv.certifications %}
            <div class="sidebar-section">
                <h2>Certifications</h2>
                {% for cert in cv.certifications %}
                {% if cert.expiry | is_active_cert %}
                <div class="cert-item">
                    <div class="cert-name">{{ cert.name }}</div>
                    <div class="cert-issuer">{{ cert.issuer }}</div>
                    <div class="cert-date">{{ cert.date | format_date }}</div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <!-- Main Content Column -->
        <div class="content-column">
            <!-- About -->
            {% if cv.about %}
            <div class="section">
                <h2>Professional Summary</h2>
                <div class="about-text">
                    {{ cv.about.summary | replace('\n', ' ') | safe }}
                </div>
                {% if cv.about.total_experience_start %}
                <div class="experience-total">
                    Total Experience: {{ cv.about.total_experience_start | calculate_years }}+ years
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Work Experience -->
            {% if cv.work_experience %}
            <div class="section" id="experience-section">
                <h2>Professional Experience</h2>
                {% for job in cv.work_experience %}
                <div class="experience-item">
                    <div class="job-header">
                        <div>
                            <div class="job-title">{{ job.position }}</div>
                            <div class="job-company">{{ job.company }}{% if job.location %} • {{ job.location }}{% endif %}</div>
                        </div>
                        <div class="job-dates">
                            {{ job.start_date | format_date }} - {{ job.end_date | format_date }}
                        </div>
                    </div>
                    <div class="job-description">
                        {{ job.description | replace('\n', ' ') | replace('- ', '• ') | safe }}
                    </div>
                    {% if job.technologies %}
                    <div class="tech-tags">
                        <strong>Technologies:</strong>
                        {% for tech in job.technologies %}
                        <span>{{ tech }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Education -->
            {% if cv.education %}
            <div class="section">
                <h2>Education</h2>
                {% for edu in cv.education %}
                <div class="education-item">
                    <div class="edu-header">
                        <div>
                            <div class="edu-degree">{{ edu.degree }}</div>
                            {% if edu.specialization %}
                            <div class="text-small" style="color: #6b7280;">Specialization: {{ edu.specialization }}</div>
                            {% endif %}
                            <div class="edu-institution">{{ edu.institution }}{% if edu.location %} • {{ edu.location }}{% endif %}</div>
                        </div>
                        <div class="edu-dates">
                            {{ edu.start_date | format_date }} - {{ edu.end_date | format_date }}
                        </div>
                    </div>
                    {% if edu.grade %}
                    <div class="text-small mb-small" style="color: #4b5563;">
                        <strong>Grade:</strong> {{ edu.grade }}
                    </div>
                    {% endif %}
                    {% if edu.highlights %}
                    <div class="edu-highlights">
                        <ul>
                            {% for highlight in edu.highlights[:4] %}
                            <li>{{ highlight }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Publications -->
            {% if cv.publications %}
            <div class="section">
                <h2>Publications</h2>
                {% for pub in cv.publications %}
                <div class="publication-item">
                    <span class="publication-title">{{ pub.title }}</span>.
                    <span class="publication-journal">{{ pub.journal }}</span> ({{ pub.year }}).
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</body>
</html>
